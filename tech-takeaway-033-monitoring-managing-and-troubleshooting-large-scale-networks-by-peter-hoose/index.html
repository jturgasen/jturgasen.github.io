<!DOCTYPE html>
<html lang="en">

    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Tech Takeaway 033 Monitoring Managing and Troubleshooting Large Scale Networks by Peter Hoose | Josh Turgasen’s Tech Blog SaaS Cloud DevOps Information Security</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Tech Takeaway 033 Monitoring Managing and Troubleshooting Large Scale Networks by Peter Hoose" />
<meta name="author" content="josh" />
<meta property="og:locale" content="en" />
<meta name="description" content="executive saas leadership software development SRE SWE chef ansible terraform gke google cloud aws amazon web services cloud azure python kubernetes iac infrastructure as code iaas agile k8s CICD docker containers AKS azure configuration management microservices consul vault hashicorp linux red hat rhel openshift mesos scrum master cybersecurity information security cissp wgu continuous delivery continuous integration gke networking chef puppet ansible site reliability engineering monitoring alerting incidents seag notes" />
<meta property="og:description" content="executive saas leadership software development SRE SWE chef ansible terraform gke google cloud aws amazon web services cloud azure python kubernetes iac infrastructure as code iaas agile k8s CICD docker containers AKS azure configuration management microservices consul vault hashicorp linux red hat rhel openshift mesos scrum master cybersecurity information security cissp wgu continuous delivery continuous integration gke networking chef puppet ansible site reliability engineering monitoring alerting incidents seag notes" />
<link rel="canonical" href="https://jturgasen.github.io/tech-takeaway-033-monitoring-managing-and-troubleshooting-large-scale-networks-by-peter-hoose/" />
<meta property="og:url" content="https://jturgasen.github.io/tech-takeaway-033-monitoring-managing-and-troubleshooting-large-scale-networks-by-peter-hoose/" />
<meta property="og:site_name" content="Josh Turgasen’s Tech Blog SaaS Cloud DevOps Information Security" />
<meta property="og:image" content="https://jturgasen.github.io/monitoring.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2016-02-21T00:00:00-07:00" />
<script type="application/ld+json">
{"image":"https://jturgasen.github.io/monitoring.jpg","url":"https://jturgasen.github.io/tech-takeaway-033-monitoring-managing-and-troubleshooting-large-scale-networks-by-peter-hoose/","author":{"@type":"Person","name":"josh"},"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://jturgasen.github.io/logo-dark.svg"},"name":"josh"},"headline":"Tech Takeaway 033 Monitoring Managing and Troubleshooting Large Scale Networks by Peter Hoose","dateModified":"2016-02-21T00:00:00-07:00","datePublished":"2016-02-21T00:00:00-07:00","description":"executive saas leadership software development SRE SWE chef ansible terraform gke google cloud aws amazon web services cloud azure python kubernetes iac infrastructure as code iaas agile k8s CICD docker containers AKS azure configuration management microservices consul vault hashicorp linux red hat rhel openshift mesos scrum master cybersecurity information security cissp wgu continuous delivery continuous integration gke networking chef puppet ansible site reliability engineering monitoring alerting incidents seag notes","mainEntityOfPage":{"@type":"WebPage","@id":"https://jturgasen.github.io/tech-takeaway-033-monitoring-managing-and-troubleshooting-large-scale-networks-by-peter-hoose/"},"@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta property="og:image" content="https://jturgasen.github.io/uploads/"/>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="shortcut icon" type="image/png" href="/uploads/favicon.png">
  <link rel="alternate" type="application/rss+xml" title="Josh Turgasen&#39;s Tech Blog | SaaS Cloud DevOps Information Security" href="/feed.xml">
  <link rel="icon" href="/uploads/favicon-tux.png" type="image/x-icon" />
  <script src="/assets/js/main.min.js"></script>
  
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55182074-1', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>


    <body>

    










<div class="uk-position-relative uk-background-center-center uk-background-cover" style="background-image: url(https://jturgasen.github.io/uploads/monitoring.jpg);"><div class="uk-position-cover" style=" background: rgba(0, 0, 0, 0.5);"></div>

  
    <div data-uk-sticky="animation: uk-animation-slide-top; top: 200; sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky navbar-background uk-dark; cls-inactive: uk-navbar-transparent uk-light">
      <nav class="uk-navbar-container">
        
          <div class="uk-container">
  <div data-uk-navbar>
    <div class="uk-navbar-left">

      <a class="uk-navbar-item uk-logo" href="/">
        
          
            <img class="uk-logo-inverse" src="https://jturgasen.github.io/uploads/logo-light.svg" alt="Josh Turgasen's Tech Blog | SaaS Cloud DevOps Information Security">
          
          
            <img src="https://jturgasen.github.io/uploads/logo-dark.svg" alt="Josh Turgasen's Tech Blog | SaaS Cloud DevOps Information Security">
          
        
      </a>

      <ul class="uk-navbar-nav uk-visible@m">
        
      </ul>
    </div>

    <div class="uk-navbar-center">
      <ul class="uk-navbar-nav uk-visible@m">
        
          
          
          
            <li>
              
                <a href="#">Touch</a>
              
              
                <div class="uk-navbar-dropdown">
                  <ul class="uk-nav uk-navbar-dropdown-nav">
                    
                      
                        
                        
                        <li><a href="/">Home</a></li>
                      
                    
                      
                        
                        
                        <li><a href="/blog/">Tech Blog</a></li>
                      
                    
                      
                        
                        
                        <li><a href="/cards/">About & Links</a></li>
                      
                    
                  </ul>
                </div>
              
            </li>
          
        
      </ul>
    </div>

    <div class="uk-navbar-right">
      <ul class="uk-navbar-nav uk-visible@m">
        
      </ul>

      

      

      <a class="uk-navbar-toggle uk-hidden@m" href="#nav-mobile" aria-label="Mobile Navigation" data-uk-navbar-toggle-icon data-uk-toggle></a>

    </div>
    
  </div>
</div>

        
      </nav>
    </div>
  

  
  <div class="uk-position-relative uk-container">
    <div class="uk-section uk-section-large uk-width-1-1 uk-light" data-uk-parallax="y: 100;">
      
        <div class="uk-flex uk-text-center uk-flex-middle uk-flex-center uk-container uk-container-small">
          <div class="uk-width-1-1">
            <h1 class="uk-heading-medium">Tech Takeaway 033 Monitoring Managing and Troubleshooting Large Scale Networks by Peter Hoose</h1>
            
            
              <div class="uk-flex uk-flex-center uk-margin-medium-top">
                

<div class="uk-article-meta" itemscope itemtype="http://schema.org/Person">
  <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex uk-flex-middle">

    
      <div>
        <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" class="avatar" data-src="https://jturgasen.github.io/uploads/avatar-josh.png" alt="Josh Turgasen" itemprop="image" data-uk-img>
      </div>
    

    <div>
      
        Written by <span itemprop="name"><span itemprop="name"><strong>Josh Turgasen</strong></span></span>
      
      <time datetime="2016-02-21T00:00:00-07:00">
          
          Feb 21, 2016
      </time>
    </div>

  </div>
</div>

              </div>
            
          </div>
        </div>
      
    </div>
  </div>
  
</div>

    
    
    

    
      <div class="uk-section uk-section-large">
        <div class="uk-container uk-container-default">
          
            <div class="uk-grid-large" data-uk-grid>
              <div class="uk-width-expand@m">
                <article class="uk-article">
  <div class="uk-article-content button-link uk-margin-medium-top-">
    <div class="uk-section uk-section-large">
        <div class="uk-container uk-container-xsmall uk-position-relative">


  <div>
    
    
    <div class="uk-article-content"><iframe width="560" height="315" src="https://www.youtube.com/embed/BRY9xwg5nAU" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</div>
  </div>

</div>
      </div>

<p>Takeaways:</p>

<ul>
  <li>Must take risks to make progress</li>
  <li>Embrace hacks - sometimes they’re necessary</li>
  <li>Myths about large networks
    <ul>
      <li>Automation fixes everything (it’s a tool, addon, augment)</li>
      <li>We’ve fixed everything (Google/FB/Twitter’s network)</li>
      <li>This talk doesn’t apply to you (it does)</li>
    </ul>
  </li>
  <li><strong>Microbursts</strong> are rapid bursts of packets that lead to failures (pack loss, RSTs, TCP retrans, etc)</li>
  <li>Determine which counter/metric will confirm it’s a microburst, then isolate the problem (does it only happen on switch X and not the others?)</li>
  <li>They determined certain ports would burst to line rate in parallel</li>
  <li>Note that they 30 second average counter on the port did NOT show this behavior: they had to sniff the traffic to see it</li>
  <li>How bursty is each flow?</li>
  <li>Lessons learned
    <ul>
      <li>Resolved issues (gj)</li>
      <li>They got RCA (good)</li>
      <li>They used software to fix the problem (ok)</li>
      <li>Service owner identified the problem - engineers/ops should know before customers</li>
      <li>Took a long time to resolve (weeks/months)</li>
      <li>Small loss can cause significant impact on a service</li>
    </ul>
  </li>
  <li>Link imbalance is the next topic….</li>
  <li>They had a single link that would spike to 100%, the other 3 were normal</li>
  <li>First thing they did was shut down the link, see what happens..and it moved to a link on a completely unrelated pair of switches</li>
  <li><strong>Fat flow</strong> is when you shut down a link, and the problem moves because the traffic is still flowing but now it simply uses a different path</li>
  <li>A fat flow would explain the link getting pegged, but the other 3 links in the bond had LESS traffic while the link was pegged</li>
  <li>Problem is only on backbone devices, only happens when a link is &gt;80% utilized, and the problem was migratory</li>
  <li>They tried something where they changed the hashing method that determines which link a flow goes over…<strong>worked for a few hours</strong></li>
  <li>They then wrote some software to monitor for the issue and fire when it was found</li>
  <li>It sent message to FBAR (cronjob on steriods, auto-remediation) -&gt; roll hash -&gt; works for a few hours -&gt; continue monitoring</li>
  <li>They made a list of
    <ul>
      <li>What they were going to examine/measure and</li>
      <li>What they expected to see for each object</li>
      <li>eg: TCP retrans should back off due to congestion, etc etc</li>
    </ul>
  </li>
  <li><strong>For some reason, TCP tried harder during congestion rather than backing off</strong></li>
  <li>For some reason, open connections increased during the congestion, and fell off when the congestion stopped</li>
  <li>They then determined that the connections went from caching layer to DB layer</li>
  <li>Their caching layer used a <strong>MRU</strong> caching policy</li>
  <li>This means last conn that had a reply is the one where the next data is sent.  If that last connection is slow/congested…..</li>
  <li>It keeps trying harder and harder</li>
  <li>So they changed from MRU and that fixed it, done</li>
  <li>They did the usual for network monitoring: alert if &gt;X% loss or latency</li>
  <li>They started at 5% loss and moved the threshold down with time</li>
  <li><strong>1% TCP packet loss can result in 50% reduction in throughput</strong></li>
  <li>0.00010% loss can reduce throughput by 50% on 200ms RTT flows</li>
  <li>They talk about the various TCP algos and how they deal with and how fast they recover from loss/congestion</li>
  <li>Monitor interfaces for loss.  It’s super easy to fix and less packet loss is better</li>
  <li>Their interface monitoring workflow is automated - when it finds one, it takes it out of service and puts in a ticket with the hardware techs</li>
  <li>He also notes that all these great things were NOT accomplished with politices, change controls, process, etc etc - just teamwork and software</li>
  <li>FBAR processes 3.37b messages per month.  1% are real problems</li>
  <li>FBAR auto-remediates (FaceBook Auto Remediation?)stuff.  It resolved 99.6% of problems</li>
  <li>You need 150 engineers to equal FBAR</li>
  <li>When a fan on a router dies, FBAR gracefully redirects/bleeds traffic off, then takes the router out of service (vs overheat and fail)</li>
  <li>How do they determine if interface is down?  Good old syslog</li>
  <li>Watch for BGP state, scrape devices for BGP and OSPF state, etc</li>
  <li>They use SNMP</li>
  <li>After gathering all of this info, they simple write software that would emulate what a human would do with the info
    <ul>
      <li>What actions would a human take with this info?  Script that.</li>
    </ul>
  </li>
  <li>They also use pattern detection in addtion to the usual threshold -&gt; alert</li>
</ul>

    
        <div class="uk-child-width-auto uk-grid-small uk-grid uk-flex-center uk-margin-medium-top" data-uk-grid>
  
    <div>
      <a class="sharer uk-link-muted" data-sharer="twitter" data-title="Tech Takeaway 033 Monitoring Managing and Troubleshooting Large Scale Networks by Peter Hoose" data-url="https://jturgasen.github.io/tech-takeaway-033-monitoring-managing-and-troubleshooting-large-scale-networks-by-peter-hoose/"><span data-uk-icon="icon: twitter; ratio: 1.2"></span></a>
    </div>
  
  
    <div>
      <a class="sharer uk-link-muted" data-sharer="facebook" data-url="https://jturgasen.github.io/tech-takeaway-033-monitoring-managing-and-troubleshooting-large-scale-networks-by-peter-hoose/"><span data-uk-icon="icon: facebook; ratio: 1.2"></span></a>
    </div>
  
  
    <div>
      <a class="sharer uk-link-muted" data-sharer="linkedin" data-url="https://jturgasen.github.io/tech-takeaway-033-monitoring-managing-and-troubleshooting-large-scale-networks-by-peter-hoose/"><span data-uk-icon="icon: linkedin; ratio: 1.2"></span></a>
    </div>
  
  
  
    <div>
      <a class="sharer uk-link-muted" data-sharer="reddit" data-url="https://jturgasen.github.io/tech-takeaway-033-monitoring-managing-and-troubleshooting-large-scale-networks-by-peter-hoose/"><span data-uk-icon="icon: reddit; ratio: 1.2"></span></a>
    </div>
  
</div>
    
  </div>

<br><br>

<div class="PageNavigation">
  
    <a class="prev" href="/tech-takeaway-032-the-state-of-the-art-in-microservices-by-adrian-cockcroft/">&laquo; Tech Takeaway 032 The State of the Art in Microservices by Adrian Cockcroft</a>
  
  <br><br><br>
  
    <a class="next" href="/tech-takeaway-034-building-a-billion-user-load-balancer-by-patrick-shuff/">Tech Takeaway 034 Building a Billion User Load Balancer by Patrick Shuff &raquo;</a>
  
</div>

</article>

              </div>
              <aside class="uk-width-1-3@m">
                



  <div class="uk-margin-large-bottom">
    

          
            <h4 class="uk-margin-small-bottom">Touch</h4>
            <ul class="uk-nav">
              
                

                  

                  <li><a href="/" class="uk-link-text">Home</a></li>

                

                  

                  <li><a href="/blog/" class="uk-link-text">Tech Blog</a></li>

                

                  

                  <li><a href="/cards/" class="uk-link-text">About & Links</a></li>

                
              
            </ul>
          

      
  </div>


              </aside>
            </div>
          
        </div>
      </div>
    

    
      <footer class="uk-section uk-section-secondary uk-text-center uk-text-muted uk-link-muted">
    <div class="uk-container uk-container-small">

        <div>
            <ul class="uk-subnav uk-flex-center">
                
                    
                    
                    
                        <li><a href="/" >Home</a></li>
                    
                
                    
                    
                    
                        <li><a href="/blog/" >Tech Blog</a></li>
                    
                
                    
                    
                    
                        <li><a href="/cards/" >About & Links</a></li>
                    
                
            </ul>
        </div>
        
          <div class="uk-margin-medium">
              <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex-center uk-grid">
                  






<div>
    <a href="https://www.linkedin.com/in/jturgasen" data-uk-icon="icon: linkedin" class="uk-icon-link uk-icon" aria-label="LinkedIn" rel="noopener" target="_blank"></a>
</div>





<div>
    <a href="https://www.github.com/jturgasen" data-uk-icon="icon: github" class="uk-icon-link uk-icon" aria-label="Github" rel="noopener" target="_blank"></a>
</div>


<div>
    <a href="mailto:jturgasen@gmail.com" data-uk-icon="icon: mail" class="uk-icon-link uk-icon" aria-label="Mail" rel="noopener" target="_blank"></a>
</div>


<div>
    <a href="https://www.joshturgasen.com" data-uk-icon="icon: link" class="uk-icon-link uk-icon" aria-label="Link" rel="noopener" target="_blank"></a>
</div>


              </div>
          </div>
        
        <div class="uk-margin-medium uk-text-small copyright">By <a href="https://unbound.studio/" target="_blank">Unbound Studio</a> in Mexico City.<br>Made his own by <a href=mailto:jturgasen@gmail.com>JoshT</a></div>

    </div>
</footer>

    

    <div id="nav-mobile" data-uk-offcanvas="flip: true; overlay: true">
    <div class="uk-offcanvas-bar">

        <button class="uk-offcanvas-close" type="button" data-uk-close></button>

        <ul class="uk-nav uk-nav-primary">
            <li><a class="uk-logo uk-margin-small-bottom" href="/"><img src="https://jturgasen.github.io/uploads/logo-dark.svg" alt="Josh Turgasen's Tech Blog | SaaS Cloud DevOps Information Security"></a></li>
            
                
            <li><a href="https://jturgasen.github.io/" >Home</a></li>
            
                
            <li><a href="https://jturgasen.github.io/blog/" >Tech Blog</a></li>
            
                
            <li><a href="https://jturgasen.github.io/cards/" >About & Links</a></li>
            
        </ul>

        <div class="uk-margin-small-top uk-text-center uk-text-muted uk-link-muted">
            <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex-center uk-grid">
                






<div>
    <a href="https://www.linkedin.com/in/jturgasen" data-uk-icon="icon: linkedin" class="uk-icon-link uk-icon" aria-label="LinkedIn" rel="noopener" target="_blank"></a>
</div>





<div>
    <a href="https://www.github.com/jturgasen" data-uk-icon="icon: github" class="uk-icon-link uk-icon" aria-label="Github" rel="noopener" target="_blank"></a>
</div>


<div>
    <a href="mailto:jturgasen@gmail.com" data-uk-icon="icon: mail" class="uk-icon-link uk-icon" aria-label="Mail" rel="noopener" target="_blank"></a>
</div>


<div>
    <a href="https://www.joshturgasen.com" data-uk-icon="icon: link" class="uk-icon-link uk-icon" aria-label="Link" rel="noopener" target="_blank"></a>
</div>


            </div>
        </div>

    </div>
</div>


    

    </body>

</html>
