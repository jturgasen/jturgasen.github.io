<!DOCTYPE html>
<html lang="en">

    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Tech Takeaway 029 Scaling Facebook with OpenSource Tools by David Recordon | Josh Turgasen’s Tech Blog SaaS Cloud DevOps Information Security</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Tech Takeaway 029 Scaling Facebook with OpenSource Tools by David Recordon" />
<meta name="author" content="josh" />
<meta property="og:locale" content="en" />
<meta name="description" content="executive saas leadership software development SRE SWE chef ansible terraform gke google cloud aws amazon web services cloud azure python kubernetes iac infrastructure as code iaas agile k8s CICD docker containers AKS azure configuration management microservices consul vault hashicorp linux red hat rhel openshift mesos scrum master cybersecurity information security cissp wgu continuous delivery continuous integration gke networking chef puppet ansible site reliability engineering monitoring alerting incidents seag notes" />
<meta property="og:description" content="executive saas leadership software development SRE SWE chef ansible terraform gke google cloud aws amazon web services cloud azure python kubernetes iac infrastructure as code iaas agile k8s CICD docker containers AKS azure configuration management microservices consul vault hashicorp linux red hat rhel openshift mesos scrum master cybersecurity information security cissp wgu continuous delivery continuous integration gke networking chef puppet ansible site reliability engineering monitoring alerting incidents seag notes" />
<link rel="canonical" href="https://jturgasen.github.io/tech-takeaway-029-scaling-facebook-with-opensource-tools-by-david-recordon/" />
<meta property="og:url" content="https://jturgasen.github.io/tech-takeaway-029-scaling-facebook-with-opensource-tools-by-david-recordon/" />
<meta property="og:site_name" content="Josh Turgasen’s Tech Blog SaaS Cloud DevOps Information Security" />
<meta property="og:image" content="https://jturgasen.github.io/facebook.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2015-08-01T00:00:00-06:00" />
<script type="application/ld+json">
{"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://jturgasen.github.io/logo-dark.svg"},"name":"josh"},"url":"https://jturgasen.github.io/tech-takeaway-029-scaling-facebook-with-opensource-tools-by-david-recordon/","mainEntityOfPage":{"@type":"WebPage","@id":"https://jturgasen.github.io/tech-takeaway-029-scaling-facebook-with-opensource-tools-by-david-recordon/"},"image":"https://jturgasen.github.io/facebook.jpg","author":{"@type":"Person","name":"josh"},"description":"executive saas leadership software development SRE SWE chef ansible terraform gke google cloud aws amazon web services cloud azure python kubernetes iac infrastructure as code iaas agile k8s CICD docker containers AKS azure configuration management microservices consul vault hashicorp linux red hat rhel openshift mesos scrum master cybersecurity information security cissp wgu continuous delivery continuous integration gke networking chef puppet ansible site reliability engineering monitoring alerting incidents seag notes","headline":"Tech Takeaway 029 Scaling Facebook with OpenSource Tools by David Recordon","dateModified":"2015-08-01T00:00:00-06:00","datePublished":"2015-08-01T00:00:00-06:00","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta property="og:image" content="https://jturgasen.github.io/uploads/"/>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="shortcut icon" type="image/png" href="/uploads/favicon.png">
  <link rel="alternate" type="application/rss+xml" title="Josh Turgasen&#39;s Tech Blog | SaaS Cloud DevOps Information Security" href="/feed.xml">
  <link rel="icon" href="/uploads/favicon-tux.png" type="image/x-icon" />
  <script src="/assets/js/main.min.js"></script>
  
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55182074-1', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>


    <body>

    










<div class="uk-position-relative uk-background-center-center uk-background-cover" style="background-image: url(https://jturgasen.github.io/uploads/facebook.jpg);"><div class="uk-position-cover" style=" background: rgba(0, 0, 0, 0.5);"></div>

  
    <div data-uk-sticky="animation: uk-animation-slide-top; top: 200; sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky navbar-background uk-dark; cls-inactive: uk-navbar-transparent uk-light">
      <nav class="uk-navbar-container">
        
          <div class="uk-container">
  <div data-uk-navbar>
    <div class="uk-navbar-left">

      <a class="uk-navbar-item uk-logo" href="/">
        
          
            <img class="uk-logo-inverse" src="https://jturgasen.github.io/uploads/logo-light.svg" alt="Josh Turgasen's Tech Blog | SaaS Cloud DevOps Information Security">
          
          
            <img src="https://jturgasen.github.io/uploads/logo-dark.svg" alt="Josh Turgasen's Tech Blog | SaaS Cloud DevOps Information Security">
          
        
      </a>

      <ul class="uk-navbar-nav uk-visible@m">
        
      </ul>
    </div>

    <div class="uk-navbar-center">
      <ul class="uk-navbar-nav uk-visible@m">
        
          
          
          
            <li>
              
                <a href="#">Touch</a>
              
              
                <div class="uk-navbar-dropdown">
                  <ul class="uk-nav uk-navbar-dropdown-nav">
                    
                      
                        
                        
                        <li><a href="/">Home</a></li>
                      
                    
                      
                        
                        
                        <li><a href="/blog/">Tech Blog</a></li>
                      
                    
                      
                        
                        
                        <li><a href="/cards/">About & Links</a></li>
                      
                    
                  </ul>
                </div>
              
            </li>
          
        
      </ul>
    </div>

    <div class="uk-navbar-right">
      <ul class="uk-navbar-nav uk-visible@m">
        
      </ul>

      

      

      <a class="uk-navbar-toggle uk-hidden@m" href="#nav-mobile" aria-label="Mobile Navigation" data-uk-navbar-toggle-icon data-uk-toggle></a>

    </div>
    
  </div>
</div>

        
      </nav>
    </div>
  

  
  <div class="uk-position-relative uk-container">
    <div class="uk-section uk-section-large uk-width-1-1 uk-light" data-uk-parallax="y: 100;">
      
        <div class="uk-flex uk-text-center uk-flex-middle uk-flex-center uk-container uk-container-small">
          <div class="uk-width-1-1">
            <h1 class="uk-heading-medium">Tech Takeaway 029 Scaling Facebook with OpenSource Tools by David Recordon</h1>
            
            
              <div class="uk-flex uk-flex-center uk-margin-medium-top">
                

<div class="uk-article-meta" itemscope itemtype="http://schema.org/Person">
  <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex uk-flex-middle">

    
      <div>
        <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" class="avatar" data-src="https://jturgasen.github.io/uploads/avatar-josh.png" alt="Josh Turgasen" itemprop="image" data-uk-img>
      </div>
    

    <div>
      
        Written by <span itemprop="name"><span itemprop="name"><strong>Josh Turgasen</strong></span></span>
      
      <time datetime="2015-08-01T00:00:00-06:00">
          
          Aug 1, 2015
      </time>
    </div>

  </div>
</div>

              </div>
            
          </div>
        </div>
      
    </div>
  </div>
  
</div>

    
    
    

    
      <div class="uk-section uk-section-large">
        <div class="uk-container uk-container-default">
          
            <div class="uk-grid-large" data-uk-grid>
              <div class="uk-width-expand@m">
                <article class="uk-article">
  <div class="uk-article-content button-link uk-margin-medium-top-">
    <div class="uk-section uk-section-large">
        <div class="uk-container uk-container-xsmall uk-position-relative">


  <div>
    
    
    <div class="uk-article-content"></div>
  </div>

</div>
      </div>

<p><a href="https://www.youtube.com/watch?v=HAzeJTgFwDc">Scaling Facebook with OpenSource Tools by David Recordon, presented at FOSDEM 2010</a></p>

<p>Takeaways:</p>

<ul>
  <li>Facebook originally sharded their DBs based on school (one for Harvard, one for Stanford, etc)</li>
  <li>I have 100 friends and I view my timeline.  FB must get 100 pieces of data and more (eg: comments by non-friends on my friend’s post).  This means they might be pulling from thousands of sources</li>
  <li>Also consider that some pages may need to pull from <strong>millions of sources</strong> (eg: Coca-cola and their millions of followers)</li>
  <li>They use a fairly standard architecture: LB -&gt; web -&gt; API/memcache/database architecture</li>
  <li>FB uses PHP because it’s simple to learn, simple to write, simple to read, and simple to debug</li>
  <li>They also like PHP because you don’t have to wait for it to compile before you can view your changes</li>
  <li>One issue is <strong>high CPU usage</strong> because they pull data from many sources and the data must be assembled after it’s gathered</li>
  <li><strong>HipHop</strong> transforms PHP into highly optimized C++ code.  Note that HipHop is depreciated as of 2013 and <strong>HHVM</strong> is it’s successor</li>
  <li>Use an optimizer to look for dead code branches that won’t be used or executed</li>
  <li>Questions to ask yourself if you are considering creating something as a service/API
    <ul>
      <li>How much overhead is required for maint, deploy, and the new code base?</li>
      <li>A new service creates a new failure point</li>
      <li>Can you create frameworks that are common to all services?</li>
    </ul>
  </li>
  <li>Their backend infrastructure uses a variety of languages.  Use the right language for the job</li>
  <li>FB’s <strong>Thrift</strong> (now Apache Thrift) is essentially a language-agnostic RPC server</li>
  <li>By using Thrift developers do not need to worry about serialization, connection handling, or threading</li>
  <li>Thrift has bindings for almost every language</li>
  <li>FB uses <strong>Scribe</strong> instead of syslog</li>
  <li>The idea behind Scribe is it’s a <strong>multi-tier fan-in system</strong></li>
  <li>Scribe batches messages before sending them cross-datacenter</li>
  <li>Syslog info is stored in a <strong>Hadoop + Hive cluster</strong></li>
  <li>Note that Scribe is no longer updated by FB, consider <strong>Apache Flume</strong> or a similar alternative</li>
  <li>Every “site” (API, service, etc) must have logging enabled</li>
  <li>If your site uses photos be sure to <strong>think about which size(s) you need</strong> (eg: original size + thumbnail + fixed size, etc)</li>
  <li>Originally they stored files on NFS servers and shared them via HTTP but it didn’t scale because…
    <ul>
      <li>File systems aren’t great at supporting huge numbers of files</li>
      <li>Limited by I/O and not by storage density</li>
      <li>Photo metadata was too large to fit in memory, thus each read required many disk operations (photo + metadata vs just photo)</li>
    </ul>
  </li>
  <li>Next, to scale photo serving even further, they did the usual stuff
    <ul>
      <li>Cache high volume small images</li>
      <li>Use a CDN</li>
      <li>Cache them in memory at origin</li>
      <li>Enable NFS file handle caching to reduce storage tier metadata overhead</li>
    </ul>
  </li>
  <li>When the files were stored on NFS they had to look up 3 pieces of metadata for every file (directory inode, directory data, file inode)</li>
  <li>Instead of 4 I/O operations for each photo they wanted to reduce it to 1 (photo ID that’s held in RAM + photo data from the disk)</li>
  <li>FB created <strong>Haystack</strong> to reduce photo serving overhead</li>
  <li>Hadoop is complex and hard to learn so they use <strong>Apache Hive</strong> on top of Hadoop in order to create a simpler user interface</li>
  <li>Great diagram of their data flow architecture at 23:32</li>
  <li>They break Hadoop into multiple clusters (one for Scribe, one for production data, an Adhoc query cluster that replicates data via Hive from the production cluster, etc)</li>
  <li>memcached is crucial to scaling</li>
  <li>But beware, memcached is easy to corrupt, it has a limited data model, and it’s <strong>inefficient for small items</strong></li>
  <li>They use MySQL because it uses a shared-nothing architecture</li>
  <li>FB does not use MySQL for it’s relational features and they do not do JOINs on the server.  This is because of their specific use case, not because the features are unstable</li>
  <li><strong>JOINs are done on the web server</strong></li>
  <li>When choosing infrastructure solutions they <strong>test 2 or 3 at a time and choose the best one</strong> rather than deciding on one solution and sticking with it hell or high water</li>
  <li>They make data consistency decisions on a per-service basis</li>
  <li>Photo <strong>resizes are done on the client</strong> as part of the upload process</li>
  <li>Use CDNs for images, CSS, and JavaScript</li>
  <li>They use <strong>Ganglia</strong></li>
</ul>

    
        <div class="uk-child-width-auto uk-grid-small uk-grid uk-flex-center uk-margin-medium-top" data-uk-grid>
  
    <div>
      <a class="sharer uk-link-muted" data-sharer="twitter" data-title="Tech Takeaway 029 Scaling Facebook with OpenSource Tools by David Recordon" data-url="https://jturgasen.github.io/tech-takeaway-029-scaling-facebook-with-opensource-tools-by-david-recordon/"><span data-uk-icon="icon: twitter; ratio: 1.2"></span></a>
    </div>
  
  
    <div>
      <a class="sharer uk-link-muted" data-sharer="facebook" data-url="https://jturgasen.github.io/tech-takeaway-029-scaling-facebook-with-opensource-tools-by-david-recordon/"><span data-uk-icon="icon: facebook; ratio: 1.2"></span></a>
    </div>
  
  
    <div>
      <a class="sharer uk-link-muted" data-sharer="linkedin" data-url="https://jturgasen.github.io/tech-takeaway-029-scaling-facebook-with-opensource-tools-by-david-recordon/"><span data-uk-icon="icon: linkedin; ratio: 1.2"></span></a>
    </div>
  
  
  
    <div>
      <a class="sharer uk-link-muted" data-sharer="reddit" data-url="https://jturgasen.github.io/tech-takeaway-029-scaling-facebook-with-opensource-tools-by-david-recordon/"><span data-uk-icon="icon: reddit; ratio: 1.2"></span></a>
    </div>
  
</div>
    
  </div>

<br><br>

<div class="PageNavigation">
  
    <a class="prev" href="/tech-takeaway-028-building-a-website-to-scale-target-200-million-page-views-per-day-and-beyond-by-eric-pickup/">&laquo; Tech Takeaway 027 Building a Website To Scale   Target 200 Million Page Views per Day and Beyond by Eric Pickup</a>
  
  <br><br><br>
  
    <a class="next" href="/tech-takeaway-030-automating-infrastructure-management-with-terraform-by-armon-dadgar/">Tech Takeaway 030 Automating Infrastructure Management with Terraform by Armon Dadgar &raquo;</a>
  
</div>

</article>

              </div>
              <aside class="uk-width-1-3@m">
                



  <div class="uk-margin-large-bottom">
    

          
            <h4 class="uk-margin-small-bottom">Touch</h4>
            <ul class="uk-nav">
              
                

                  

                  <li><a href="/" class="uk-link-text">Home</a></li>

                

                  

                  <li><a href="/blog/" class="uk-link-text">Tech Blog</a></li>

                

                  

                  <li><a href="/cards/" class="uk-link-text">About & Links</a></li>

                
              
            </ul>
          

      
  </div>


              </aside>
            </div>
          
        </div>
      </div>
    

    
      <footer class="uk-section uk-section-secondary uk-text-center uk-text-muted uk-link-muted">
    <div class="uk-container uk-container-small">

        <div>
            <ul class="uk-subnav uk-flex-center">
                
                    
                    
                    
                        <li><a href="/" >Home</a></li>
                    
                
                    
                    
                    
                        <li><a href="/blog/" >Tech Blog</a></li>
                    
                
                    
                    
                    
                        <li><a href="/cards/" >About & Links</a></li>
                    
                
            </ul>
        </div>
        
          <div class="uk-margin-medium">
              <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex-center uk-grid">
                  






<div>
    <a href="https://www.linkedin.com/in/jturgasen" data-uk-icon="icon: linkedin" class="uk-icon-link uk-icon" aria-label="LinkedIn" rel="noopener" target="_blank"></a>
</div>





<div>
    <a href="https://www.github.com/jturgasen" data-uk-icon="icon: github" class="uk-icon-link uk-icon" aria-label="Github" rel="noopener" target="_blank"></a>
</div>


<div>
    <a href="mailto:jturgasen@gmail.com" data-uk-icon="icon: mail" class="uk-icon-link uk-icon" aria-label="Mail" rel="noopener" target="_blank"></a>
</div>


<div>
    <a href="https://www.joshturgasen.com" data-uk-icon="icon: link" class="uk-icon-link uk-icon" aria-label="Link" rel="noopener" target="_blank"></a>
</div>


              </div>
          </div>
        
        <div class="uk-margin-medium uk-text-small copyright">By <a href="https://unbound.studio/" target="_blank">Unbound Studio</a> in Mexico City.<br>Made his own by <a href=mailto:jturgasen@gmail.com>JoshT</a></div>

    </div>
</footer>

    

    <div id="nav-mobile" data-uk-offcanvas="flip: true; overlay: true">
    <div class="uk-offcanvas-bar">

        <button class="uk-offcanvas-close" type="button" data-uk-close></button>

        <ul class="uk-nav uk-nav-primary">
            <li><a class="uk-logo uk-margin-small-bottom" href="/"><img src="https://jturgasen.github.io/uploads/logo-dark.svg" alt="Josh Turgasen's Tech Blog | SaaS Cloud DevOps Information Security"></a></li>
            
                
            <li><a href="https://jturgasen.github.io/" >Home</a></li>
            
                
            <li><a href="https://jturgasen.github.io/blog/" >Tech Blog</a></li>
            
                
            <li><a href="https://jturgasen.github.io/cards/" >About & Links</a></li>
            
        </ul>

        <div class="uk-margin-small-top uk-text-center uk-text-muted uk-link-muted">
            <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex-center uk-grid">
                






<div>
    <a href="https://www.linkedin.com/in/jturgasen" data-uk-icon="icon: linkedin" class="uk-icon-link uk-icon" aria-label="LinkedIn" rel="noopener" target="_blank"></a>
</div>





<div>
    <a href="https://www.github.com/jturgasen" data-uk-icon="icon: github" class="uk-icon-link uk-icon" aria-label="Github" rel="noopener" target="_blank"></a>
</div>


<div>
    <a href="mailto:jturgasen@gmail.com" data-uk-icon="icon: mail" class="uk-icon-link uk-icon" aria-label="Mail" rel="noopener" target="_blank"></a>
</div>


<div>
    <a href="https://www.joshturgasen.com" data-uk-icon="icon: link" class="uk-icon-link uk-icon" aria-label="Link" rel="noopener" target="_blank"></a>
</div>


            </div>
        </div>

    </div>
</div>


    

    </body>

</html>
