<!DOCTYPE html>
<html lang="en">

    <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Tech Takeaway 012 Cluster Management at Google | Josh Turgasen’s Tech Blog SaaS Cloud DevOps Information Security</title>
<meta name="generator" content="Jekyll v3.8.7" />
<meta property="og:title" content="Tech Takeaway 012 Cluster Management at Google" />
<meta name="author" content="josh" />
<meta property="og:locale" content="en" />
<meta name="description" content="executive saas leadership software development SRE SWE chef ansible terraform gke google cloud aws amazon web services cloud azure python kubernetes iac infrastructure as code iaas agile k8s CICD docker containers AKS azure configuration management microservices consul vault hashicorp linux red hat rhel openshift mesos scrum master cybersecurity information security cissp wgu continuous delivery continuous integration gke networking chef puppet ansible site reliability engineering monitoring alerting incidents seag notes" />
<meta property="og:description" content="executive saas leadership software development SRE SWE chef ansible terraform gke google cloud aws amazon web services cloud azure python kubernetes iac infrastructure as code iaas agile k8s CICD docker containers AKS azure configuration management microservices consul vault hashicorp linux red hat rhel openshift mesos scrum master cybersecurity information security cissp wgu continuous delivery continuous integration gke networking chef puppet ansible site reliability engineering monitoring alerting incidents seag notes" />
<link rel="canonical" href="https://jturgasen.github.io/tech-takeaway-012-cluster-management-at-google/" />
<meta property="og:url" content="https://jturgasen.github.io/tech-takeaway-012-cluster-management-at-google/" />
<meta property="og:site_name" content="Josh Turgasen’s Tech Blog SaaS Cloud DevOps Information Security" />
<meta property="og:image" content="https://jturgasen.github.io/google.jpg" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2014-10-26T00:00:00-06:00" />
<script type="application/ld+json">
{"publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"https://jturgasen.github.io/logo-dark.svg"},"name":"josh"},"url":"https://jturgasen.github.io/tech-takeaway-012-cluster-management-at-google/","mainEntityOfPage":{"@type":"WebPage","@id":"https://jturgasen.github.io/tech-takeaway-012-cluster-management-at-google/"},"image":"https://jturgasen.github.io/google.jpg","author":{"@type":"Person","name":"josh"},"description":"executive saas leadership software development SRE SWE chef ansible terraform gke google cloud aws amazon web services cloud azure python kubernetes iac infrastructure as code iaas agile k8s CICD docker containers AKS azure configuration management microservices consul vault hashicorp linux red hat rhel openshift mesos scrum master cybersecurity information security cissp wgu continuous delivery continuous integration gke networking chef puppet ansible site reliability engineering monitoring alerting incidents seag notes","headline":"Tech Takeaway 012 Cluster Management at Google","dateModified":"2014-10-26T00:00:00-06:00","datePublished":"2014-10-26T00:00:00-06:00","@type":"BlogPosting","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->

  <meta property="og:image" content="https://jturgasen.github.io/uploads/"/>
  <link href="https://fonts.googleapis.com/css?family=Montserrat:400,600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="shortcut icon" type="image/png" href="/uploads/favicon.png">
  <link rel="alternate" type="application/rss+xml" title="Josh Turgasen&#39;s Tech Blog | SaaS Cloud DevOps Information Security" href="/feed.xml">
  <link rel="icon" href="/uploads/favicon-tux.png" type="image/x-icon" />
  <script src="/assets/js/main.min.js"></script>
  
    <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-55182074-1', 'auto');
  ga('send', 'pageview');

</script>
  

  
</head>


    <body>

    










<div class="uk-position-relative uk-background-center-center uk-background-cover" style="background-image: url(https://jturgasen.github.io/uploads/google.jpg);"><div class="uk-position-cover" style=" background: rgba(0, 0, 0, 0.5);"></div>

  
    <div data-uk-sticky="animation: uk-animation-slide-top; top: 200; sel-target: .uk-navbar-container; cls-active: uk-navbar-sticky navbar-background uk-dark; cls-inactive: uk-navbar-transparent uk-light">
      <nav class="uk-navbar-container">
        
          <div class="uk-container">
  <div data-uk-navbar>
    <div class="uk-navbar-left">

      <a class="uk-navbar-item uk-logo" href="/">
        
          
            <img class="uk-logo-inverse" src="https://jturgasen.github.io/uploads/logo-light.svg" alt="Josh Turgasen's Tech Blog | SaaS Cloud DevOps Information Security">
          
          
            <img src="https://jturgasen.github.io/uploads/logo-dark.svg" alt="Josh Turgasen's Tech Blog | SaaS Cloud DevOps Information Security">
          
        
      </a>

      <ul class="uk-navbar-nav uk-visible@m">
        
      </ul>
    </div>

    <div class="uk-navbar-center">
      <ul class="uk-navbar-nav uk-visible@m">
        
          
          
          
            <li>
              
                <a href="#">Touch</a>
              
              
                <div class="uk-navbar-dropdown">
                  <ul class="uk-nav uk-navbar-dropdown-nav">
                    
                      
                        
                        
                        <li><a href="/">Home</a></li>
                      
                    
                      
                        
                        
                        <li><a href="/blog/">Tech Blog</a></li>
                      
                    
                      
                        
                        
                        <li><a href="/cards/">About & Links</a></li>
                      
                    
                  </ul>
                </div>
              
            </li>
          
        
      </ul>
    </div>

    <div class="uk-navbar-right">
      <ul class="uk-navbar-nav uk-visible@m">
        
      </ul>

      

      

      <a class="uk-navbar-toggle uk-hidden@m" href="#nav-mobile" aria-label="Mobile Navigation" data-uk-navbar-toggle-icon data-uk-toggle></a>

    </div>
    
  </div>
</div>

        
      </nav>
    </div>
  

  
  <div class="uk-position-relative uk-container">
    <div class="uk-section uk-section-large uk-width-1-1 uk-light" data-uk-parallax="y: 100;">
      
        <div class="uk-flex uk-text-center uk-flex-middle uk-flex-center uk-container uk-container-small">
          <div class="uk-width-1-1">
            <h1 class="uk-heading-medium">Tech Takeaway 012 Cluster Management at Google</h1>
            
            
              <div class="uk-flex uk-flex-center uk-margin-medium-top">
                

<div class="uk-article-meta" itemscope itemtype="http://schema.org/Person">
  <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex uk-flex-middle">

    
      <div>
        <img src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" class="avatar" data-src="https://jturgasen.github.io/uploads/avatar-josh.png" alt="Josh Turgasen" itemprop="image" data-uk-img>
      </div>
    

    <div>
      
        Written by <span itemprop="name"><span itemprop="name"><strong>Josh Turgasen</strong></span></span>
      
      <time datetime="2014-10-26T00:00:00-06:00">
          
          Oct 26, 2014
      </time>
    </div>

  </div>
</div>

              </div>
            
          </div>
        </div>
      
    </div>
  </div>
  
</div>

    
    
    

    
      <div class="uk-section uk-section-large">
        <div class="uk-container uk-container-default">
          
            <div class="uk-grid-large" data-uk-grid>
              <div class="uk-width-expand@m">
                <article class="uk-article">
  <div class="uk-article-content button-link uk-margin-medium-top-">
    <div class="uk-section uk-section-large">
        <div class="uk-container uk-container-xsmall uk-position-relative">


  <div>
    
    
    <div class="uk-article-content"><iframe width="560" height="315" src="https://www.youtube.com/embed/VQAAkO5B5Hg" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen=""></iframe>
</div>
  </div>

</div>
      </div>

<ul>
  <li>Failures dominate their design discussions</li>
  <li>Top of rack switch is a SPOF</li>
  <li>Power bus bars that power several racks are also considered a SPOF</li>
  <li>Diesel generators are a large SPOF.  They only get a short time (20 seconds) to start generating a ton of power (2 megawatts).  Test.</li>
  <li>What happens if a master node is down during the same time that you’re doing an upgrade?</li>
  <li>When it comes to planning for failure, don’t just plan for individual failures, also plan for multiple concurrent failures (what if this AND that is down at the same time?)</li>
  <li>The upgrade the OS if it needs it or not (every month or two).  Pretty good test.</li>
  <li>Don’t consider failure a problem, consider it normal and plan for it.  Code around it.</li>
  <li>Keep application state externally rather than internally</li>
  <li>Consider application placement.  Are all instances of an app connected to a single top of rack switch or under the same power bus bar?</li>
  <li>What happens if a data center goes down?  Does the app keep running?</li>
  <li>Worry about availability first, performance second.  Get it right first before you make it faster</li>
  <li>They gather metrics and create charts for what they call their “bin packing algorithms”.  How much capacity (CPU and RAM) on a physical system is wasted?</li>
  <li>Bin packing algorithms are key because without them you waste a lot of hardware</li>
  <li>“Resource stranding” is when you have leftover CPU in one place and leftover memory in another</li>
  <li>Track CPU used vs CPU allocated to help make better placement decisions.  Do the same for RAM.</li>
  <li>They found that they often utilize much less than they allocate.  They overcommit a lot.</li>
  <li>They do not overcommit the user-facing front end latency-sensitive work</li>
  <li>Things like “the interns MapReduces” are prime targets for overcommit</li>
  <li>They do not overcommit their external-facing VMs</li>
  <li>In general there are two types of jobs/workloads: Short lived (MapReduces) and long or forever running (web services)</li>
  <li>For service jobs, make your scheduler think harder about where to place them to avoid failures (data center, rack, cluster, power bus, etc)</li>
  <li>On the other hand, for fast / short jobs, don’t have your scheduler think too hard about where to place it</li>
  <li>They don’t dedicate machines to a particular workload.  There is no “GMail VM”.  The VM runs whatever is placed there by the scheduler</li>
  <li>Applications can interfere with each other in places that the OS can’t control: eg: the L3 CPU cache</li>
  <li>You could fix this particular problem with “cache partitioning” but x86 and Linux don’t support it</li>
  <li>They monitor “cycles per instruction” (CPI)
    <ul>
      <li>Gather CPI for all the tasks in a job</li>
      <li>Find outliers (ones that are hurting / taking too long / being impacted)</li>
      <li>Take action.  He seems to hint that they kill tasks of a batch job that are killing performance because you can always restart the task somewhere else, it’s batch)</li>
    </ul>
  </li>
  <li>They wrap stuff in containers (I assume cgroups)</li>
  <li>They link their applications statically so when the OS gets upgraded everything keeps running</li>
  <li>Like Mesos, each job/app has a config and declares what it wants (1400 copies running at all times)</li>
  <li>Job/app configs are integrated via their source control system (audit trail)</li>
  <li>They use quotas/limits/QoS for their jobs.  Eg: Your MapReduce isn’t as important as making sure search is running smooth)</li>
  <li>“If you’re not monitoring something, it’s out of control.”  Not “out of control” like crazy, but you literally lose control over it</li>
  <li>Every single process (OS level process) has a little web server running inside it to display metrics.  They then aggregate and display it.</li>
  <li>They use “bittorrent-ish” stuff to distribute an app’s binaries.  Distributing binaries to 2,000 nodes from a central host is pretty slow.</li>
  <li>You can only SSH into machines that are running one of your tasks, not every machine</li>
  <li>Even the KVM VMs live inside a container</li>
  <li>They use containers for resource isolation, execution isolation, and CPU QoS</li>
  <li>Make things “share fate”.  Keep the web server and the what they call “log roller” together.  If one dies, both should die.</li>
  <li>A collection of containers that get scheduled together (grouped together) wherever they land is called a “pod”</li>
  <li>They stick “labels” on pods (key-value pairs)</li>
  <li>You can use labels to label your pods with things like “this is a frontend app” or “this is a backend app” “or this one is a prod prod”</li>
  <li>The other advantage to labels is you can have your master scheduler go find all pods with label “frontend” or whatever</li>
  <li>You can apply multiple labels to the pods your app uses (frontend + prod, frontend + test, backend + low_priority, etc)</li>
  <li>“Replica controller” allows the engineer to set the number of pods (replicas) that their application needs</li>
  <li>Labels seem to be hierarchical.  The number of replicas is on the top and below that is the attributes / labels of the pod</li>
  <li>Describe the end state and let automated systems get you there</li>
  <li>Every pod gets it’s own IP</li>
  <li>When it comes to calculating oversubscription, do it dynamically instead of statically.  Monitor / trend utilization and decide on the fly.</li>
  <li>Put in triggers / limits for auto-scaling and resource utilization.  Memory leaks suck.</li>
  <li>Be careful with labels / job descriptions / attributes.  Google has 238 possible labels.  That’s too many.</li>
</ul>

    
        <div class="uk-child-width-auto uk-grid-small uk-grid uk-flex-center uk-margin-medium-top" data-uk-grid>
  
    <div>
      <a class="sharer uk-link-muted" data-sharer="twitter" data-title="Tech Takeaway 012 Cluster Management at Google" data-url="https://jturgasen.github.io/tech-takeaway-012-cluster-management-at-google/"><span data-uk-icon="icon: twitter; ratio: 1.2"></span></a>
    </div>
  
  
    <div>
      <a class="sharer uk-link-muted" data-sharer="facebook" data-url="https://jturgasen.github.io/tech-takeaway-012-cluster-management-at-google/"><span data-uk-icon="icon: facebook; ratio: 1.2"></span></a>
    </div>
  
  
    <div>
      <a class="sharer uk-link-muted" data-sharer="linkedin" data-url="https://jturgasen.github.io/tech-takeaway-012-cluster-management-at-google/"><span data-uk-icon="icon: linkedin; ratio: 1.2"></span></a>
    </div>
  
  
  
    <div>
      <a class="sharer uk-link-muted" data-sharer="reddit" data-url="https://jturgasen.github.io/tech-takeaway-012-cluster-management-at-google/"><span data-uk-icon="icon: reddit; ratio: 1.2"></span></a>
    </div>
  
</div>
    
  </div>

<br><br>

<div class="PageNavigation">
  
    <a class="prev" href="/tech-takeaway-011-lessons-from-etsy-avoiding-kitchen-nightmares/">&laquo; Tech Takeaway 011 Lessons from Etsy Avoiding Kitchen Nightmares</a>
  
  <br><br><br>
  
    <a class="next" href="/things-to-consider-when-designing-cloud-applications/">Things to Consider When Designing Cloud Applications &raquo;</a>
  
</div>

</article>

              </div>
              <aside class="uk-width-1-3@m">
                



  <div class="uk-margin-large-bottom">
    

          
            <h4 class="uk-margin-small-bottom">Touch</h4>
            <ul class="uk-nav">
              
                

                  

                  <li><a href="/" class="uk-link-text">Home</a></li>

                

                  

                  <li><a href="/blog/" class="uk-link-text">Tech Blog</a></li>

                

                  

                  <li><a href="/cards/" class="uk-link-text">About & Links</a></li>

                
              
            </ul>
          

      
  </div>


              </aside>
            </div>
          
        </div>
      </div>
    

    
      <footer class="uk-section uk-section-secondary uk-text-center uk-text-muted uk-link-muted">
    <div class="uk-container uk-container-small">

        <div>
            <ul class="uk-subnav uk-flex-center">
                
                    
                    
                    
                        <li><a href="/" >Home</a></li>
                    
                
                    
                    
                    
                        <li><a href="/blog/" >Tech Blog</a></li>
                    
                
                    
                    
                    
                        <li><a href="/cards/" >About & Links</a></li>
                    
                
            </ul>
        </div>
        
          <div class="uk-margin-medium">
              <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex-center uk-grid">
                  






<div>
    <a href="https://www.linkedin.com/in/jturgasen" data-uk-icon="icon: linkedin" class="uk-icon-link uk-icon" aria-label="LinkedIn" rel="noopener" target="_blank"></a>
</div>





<div>
    <a href="https://www.github.com/jturgasen" data-uk-icon="icon: github" class="uk-icon-link uk-icon" aria-label="Github" rel="noopener" target="_blank"></a>
</div>


<div>
    <a href="mailto:jturgasen@gmail.com" data-uk-icon="icon: mail" class="uk-icon-link uk-icon" aria-label="Mail" rel="noopener" target="_blank"></a>
</div>


<div>
    <a href="https://www.joshturgasen.com" data-uk-icon="icon: link" class="uk-icon-link uk-icon" aria-label="Link" rel="noopener" target="_blank"></a>
</div>


              </div>
          </div>
        
        <div class="uk-margin-medium uk-text-small copyright">By <a href="https://unbound.studio/" target="_blank">Unbound Studio</a> in Mexico City.<br>Made his own by <a href=mailto:jturgasen@gmail.com>JoshT</a></div>

    </div>
</footer>

    

    <div id="nav-mobile" data-uk-offcanvas="flip: true; overlay: true">
    <div class="uk-offcanvas-bar">

        <button class="uk-offcanvas-close" type="button" data-uk-close></button>

        <ul class="uk-nav uk-nav-primary">
            <li><a class="uk-logo uk-margin-small-bottom" href="/"><img src="https://jturgasen.github.io/uploads/logo-dark.svg" alt="Josh Turgasen's Tech Blog | SaaS Cloud DevOps Information Security"></a></li>
            
                
            <li><a href="https://jturgasen.github.io/" >Home</a></li>
            
                
            <li><a href="https://jturgasen.github.io/blog/" >Tech Blog</a></li>
            
                
            <li><a href="https://jturgasen.github.io/cards/" >About & Links</a></li>
            
        </ul>

        <div class="uk-margin-small-top uk-text-center uk-text-muted uk-link-muted">
            <div data-uk-grid class="uk-child-width-auto uk-grid-small uk-flex-center uk-grid">
                






<div>
    <a href="https://www.linkedin.com/in/jturgasen" data-uk-icon="icon: linkedin" class="uk-icon-link uk-icon" aria-label="LinkedIn" rel="noopener" target="_blank"></a>
</div>





<div>
    <a href="https://www.github.com/jturgasen" data-uk-icon="icon: github" class="uk-icon-link uk-icon" aria-label="Github" rel="noopener" target="_blank"></a>
</div>


<div>
    <a href="mailto:jturgasen@gmail.com" data-uk-icon="icon: mail" class="uk-icon-link uk-icon" aria-label="Mail" rel="noopener" target="_blank"></a>
</div>


<div>
    <a href="https://www.joshturgasen.com" data-uk-icon="icon: link" class="uk-icon-link uk-icon" aria-label="Link" rel="noopener" target="_blank"></a>
</div>


            </div>
        </div>

    </div>
</div>


    

    </body>

</html>
